pipeline {
 agent 'any'
 stages{
   stage('Build Maven') {
     steps {
      // Run the maven build
        withMaven(maven : 'maven') {
            bat'mvn clean install'
        }
      }
   }
   stage('Build Docker Image') {
	//steps {
           steps {
	      bat'docker build -t crbhaskar/dockerautodeploy .'
           }
	//}
   }
   stage('Push Image to Hub') {
	//steps {
           steps {
	      bat'docker login -u crbhaskar -p Meena123$'
              bat'docker push crbhaskar/dockerautodeploy'
           }
	//}
   }
  stage ('Run the image in container') {
    steps {
    docker.withServer('tcp://localhost:2375', 'dockerhub-login') {
        docker.image('crbhaskar/dockerautodeploy').withRun('-p 8080:8080') {
            /* do things */
        }
    }
    }
  }   
 }
}